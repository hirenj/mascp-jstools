<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Condensed Sequence Renderer</title>
    <script type="text/javascript">
    window.svgns = 'http://www.w3.org/2000/svg';
    </script>

    <script type="text/javascript" charset="utf-8" src="../../jsunit/app/jsUnitCore.js"></script>
    <script type="text/javascript" src="../svgweb/svg-uncompressed.js" data-path="../svgweb/"></script>
    <script type="text/javascript" src="../jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="../jquery-ui-1.7.2.min.js"></script>
    <script type="text/javascript" src="../lib/MascpService.js"></script>
    <script type="text/javascript" src="../lib/SequenceRenderer.js"></script>
    <script type="text/javascript" src="../lib/CondensedSequenceRenderer.js"></script>
    <script type="text/javascript" src="../lib/PhosphatReader.js"></script>
    <script type="text/javascript" src="../lib/TairReader.js"></script>    
    <script type="text/javascript" src="../lib/SnpReader.js"></script>
    <script type="text/javascript" src="../lib/gomap.js"></script>
    <script type="text/javascript" src="../json-2.js"></script>
    <script type="text/javascript" src="../diff_match_patch.js"></script>
    <style type="text/css">
    #result {
        width: 80%;
    }
    </style>
</head>
<body>
    <div id="result">
    </div>
    <script type="text/javascript" charset="utf-8">

        var renderer;
        var tairreader;
        var delta = 1;
        var agi = 'At5g24430.1';

        function testSimpleDisplay() {


            renderer = new MASCP.CondensedSequenceRenderer(document.getElementById('result'));

            renderer.setSequence(tairreader.result.getSequence());
            renderer.grow_container = true;

            var snpreader = new MASCP.AccessionReader(null,'../../../tair.pl');
            
            snpreader.agi = agi;
            
            snpreader.registerSequenceRenderer(renderer);

            var accessions = [
                'Col0',
                'Agu',
                'Bak2',
                'Bay',
                'Bur0',
                'Cdm0',
                'Del10',
                'Dog4',
                'Don0',
                'Ey152',
                'Fei0',
                'Istisu1',
                'Kastel1',
                'Koch1',
                'Kro0',
                'Leo1',
                'Ler1',
                'Lerik13',
                'Mer6',
                'Nemrut1',
                'Nie12',
                'Ped0',
                'Pra6',
                'Qui0',
                'Rue3131',
                'Ri0',
                'Sha',
                'Star8',
                'TueSB303',
                'TueV13',
                'TueWa12',
                'Tuescha9',
                'Vash1',
                'Vie0',
                'WalhaesB4',
                'Xan1'
            ];

            snpreader.bind('resultReceived',function() {
                snpreader.accession = accessions.shift();
                if ( ! snpreader.accession ) {
                    renderer.showLayer('insertions');
                    return;
                }
                snpreader.retrieve();
            });
                        
            snpreader.accession = accessions.shift();
            snpreader.retrieve();
            renderer.hideLayer('insertions');
            
            var phosphat = new MASCP.PhosphatReader(agi,'../../../proxy.pl');
            phosphat.registerSequenceRenderer(renderer).bind('resultReceived',function() {
                renderer.showLayer('phosphat_experimental');
            });
            phosphat.retrieve();
            console.log(phosphat);
            
            renderer.zoom = 10;
            var dragger = (new GOMap.Diagram.Dragger()).applyToElement(renderer._canvas);
        
            renderer._Navigation.hide();
            
        }

        jQuery(document).ready(function() {
            tairreader = new MASCP.TairReader(null,'../../../tair.pl');
            tairreader.agi = agi;            
            tairreader.async = false;
            tairreader.retrieve();            
            testSimpleDisplay(); 
        });
    </script>
</body>
</html>